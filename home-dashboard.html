<head>
	<title>The Borilliam</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='http://fonts.googleapis.com/css?family=Cutive' rel='stylesheet' type='text/css'>
	<script>
		function redisplayDiffTimes() {
			$('span[data-time]').each(function (index, value) {
				this.innerText = formatDate(parseInt(value.getAttribute('data-time')));
			});
		}
		$(function () {
			window.setInterval(redisplayDiffTimes, 10000);
		});
	</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41645535-1', 'borilliam.com');
  ga('send', 'pageview');

</script>
</head>

<body>
	{{> body}}
</body>

<template name="body">
<div class="container-fluid" style="padding-top: 1.5em">
	<div class="well titlebar image" style="background-image: url({{background}})">
		<span class="borilliam-title" ><span class="the">The</span><br>&nbsp;&nbsp;Borilliam</span>
		<div class="pull-right" style="padding-top: 20px">
			<div>
				{{> currentUserImage}}
			</div>
			{{loginButtons}}
		</div>
	</div>
	<div class="row-fluid">
		<div class="span4">
			{{#if currentUser}}
			{{> users}}
			{{/if}}
		</div>
		<div class="span8">
			{{#if currentUser}}
			{{> room}}
			{{> send-message}}
			{{> items}}
			{{> messages}}
			{{else}}
			You are not logged in.
			{{/if}}
		</div>
	</div>
	<div class="row-fluid">
		<div class="span12 text-center">
			<img src="/fortress.png" width="64px">
		</div>
	</div>
</div>
</template>

<template name="weather-report">
<div class="top-login-block">
{{#with weather}}
	{{weather.weather}} / {{feelslike_string}}
{{/with}}
<br/>
</div>
</template>

<template name="room">
We are in the {{roomName}}.<br>
</template>

<template name="items">
<div class="room-items">
	{{#each items}}
	<div class="room-item">
		<div class="image pull-left">
			{{#if imageUrl}}
				<img src="{{imageUrl}}" />
			{{else}}
				<a class="assign" href="javascript:getItemImage('{{_id}}')">...</a>
			{{/if}}
		</div>
		<div class="name">
			{{name}}
		</div>
		<div class="tools">
			<button class="take-btn btn btn-small btn-info">
				<i class="icon-white icon-upload"></i>
			</button>
		</div>
	</div>
{{else}}
	There are no items in this room.
{{/each}}
</div>
</template>

<template name="currentUserImage">
<div class="current-user">
	<img src="{{imageUrl}}" />
</div>
</template>

<template name="user-item">
<div class="user-item row-fluid">
	{{#ifMine this}}
		<div class="tools">
			<button class="drop-btn btn btn-small btn-info">
				<i class="icon-white icon-download"></i>
			</button>
		</div>
	{{/ifMine}}
	<div class="span2">
		{{#if imageUrl}}
			<img src="{{imageUrl}}" />
		{{else}}
			<a class="assign" href="javascript:getItemImage('{{_id}}')">...</a>
		{{/if}}
	</div>
	<div class="name">
		{{name}}
	</div>
</div>
</template>
<template name="user-items">
<div class="container-fluid user-items">
	{{#each items}}
		{{> user-item}}
	{{else}}
		Empty bag.
	{{/each}}
</div>
</template>

<template name="user">
<div class="user">
	<div class="image hidden-phone" style="background-image: url({{imageUrl}})"></div>
	<div class="image visible-phone" style="background-image: url({{imageUrl}})"></div>
	<div class="user-info">
		{{profile.name}}
	</div>
	<div class="clearfix">
	</div>
	{{> user-items}}
</div>
</template>
<template name="users">
<div class="hidden-mobile users">

{{#each users}}
	{{> user}}
{{else}}
	No users.
{{/each}}

</div>
</template>

<template name="messages">
{{#if messages}}
<ul class="unstyled">
	{{#each messages}}
		{{> message}}
	{{/each}}
</ul>
{{else}}
	No messages.
{{/if}}
</template>

<template name="send-message">
{{#if currentUser}}
	<form onsubmit="event.preventDefault();" class="form-horizontal">
		<input type="text" style="width:50%" name="new-message"></input>
		<input class="btn btn-primary" type="button" name="send" value="Mentum"></input>
	</form>
{{/if}}
</template>

<template name="memificator">
<div class="meme-container"
	style="background-image: url({{imageUrl}})">
	<div class="inner">
		<div class="top">
			<span contenteditable data-msg-id="{{_id}}" id="meme-{{_id}}-title" class="title meme-text">{{memeTitle}}</span><br/>
		</div>
		<div class="bottom">
			<span contenteditable data-msg-id="{{_id}}" id="meme-{{_id}}-subtitle" class="subtitle meme-text">{{memeSubtitle}}</span>
		</div>
	</div>
</div>
</template>

<template name="memeDisplay">
<div class="image meme-container"
	style="background-image: url({{imageUrl}})">
	<div class="inner">
		<div class="top">
			<span class="title meme-text">{{memeTitle}}</span><br/>
		</div>
		<div class="bottom">
			<span class="subtitle meme-text">{{memeSubtitle}}</span>
		</div>
	</div>
</div>
</template>

<template name="message">
<li class="message feature well media">
	<div class="pull-left">
		<div class="image hidden-phone" style="background-image:url({{getAuthorImage authorId}})"></div>
		<div class="image visible-phone" style="background-image:url({{getAuthorImage authorId}})"></div>
	</div>
	<div class="media-body">
		<div class="media-heading">
			<span class="author">{{author.profile.name}}</span>
			<br>
			<span class="time muted">
				<span data-time="{{timestamp}}">{{date-render timestamp}}</span>
			</span>
		</div>
		{{#if meme}}
			{{#ifOwner this}}
				{{> memificator}}
			{{else}}
				{{> memeDisplay}}
			{{/ifOwner}}
		{{else}}
		{{#if msg}}
			<span class="sent-message">{{say msg}}</span>
		{{/if}}
		{{#if imageUrl}}
			<img src="{{imageUrl}}" />
		{{/if}}
		{{#if youtube}}
		<iframe id="ytplayer" type="text/html" width="400" height="244"
			src="http://www.youtube.com/embed/?q={{youtube}}&autoplay=0&origin=http://example.com"
			frameborder="0"></iframe>
		{{/if}}
		{{/if}}
		<div class="tools">
			{{#ifOwner this}}
				{{#if imageUrl}}
					{{#if meme}}
					{{else}}
						<button class="meme-btn btn btn-small btn-warning">
							<i class="icon-white icon-fire"></i>
						</button>
					{{/if}}
				{{/if}}
				<button class="btn btn-warning delete-btn btn-small">
					<i class="icon-white icon-trash"></i>
				</button>
			{{else}}
				{{#ifNotLoved this}}
					<button class="love-btn btn btn-small btn-danger">
						<i class="icon-white icon-heart"></i>
					</button>
				{{/ifNotLoved}}
			{{/ifOwner}}
		</div>
		<div>
			{{#loveLoop this}}
				<i class="icon-heart"></i>
			{{/loveLoop}}
		</div>
	</div>
</li>
</template>
