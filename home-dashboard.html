<head>
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
	<link href="http://netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
	<script>
		function redisplayDiffTimes() {
			$('span[data-time]').each(function (index, value) {
				this.innerText = formatDate(parseInt(value.getAttribute('data-time')));
			});
		}
		$(function () {
			window.setInterval(redisplayDiffTimes, 10000);
		});
	</script>
</head>

<body>
	{{> body}}
</body>

<template name="body">
	<header style="background-image: url({{background}})">
		<h1>{{settings.title}} {{roomName}}</h1>
		<div class="login-tools">
			{{loginButtons}}
		</div>
		<div class="clearfix"></div>
	</header>
	{{#if messages_ready}}
	<section id="send-message">
		{{> send-message}}
	</section>
	<section id="upload-photo">
		{{> upload-photo}}
	</section>
		{{> messages}}
{{else}}
	{{#if loggingIn}}
		{{#if currentUser}}
			Logging in...
		{{else}}
			Please stand by and await further instructions.
		{{/if}}
	{{else}}
		{{#if currentUser}}
			<div class="loading">Loading messages...</div>
		{{else}}
			You are not logged in.
		{{/if}}
	{{/if}}
{{/if}}
	<section id="footer">
		<img src="/fortress.png" width="64px">
	</section>
</template>

<template name="weather-report">
<div class="top-login-block">
{{#with weather}}
	{{weather.weather}} / {{feelslike_string}}
{{/with}}
<br/>
</div>
</template>

<template name="items">
<div class="room-items">
	{{#each items}}
	<div class="room-item">
			{{#if imageUrl}}
			<div class="image pull-left" style="background-image:url({{imageUrl}})">
			</div>
			{{else}}
			<div class="image pull-left">
				<a class="assign" href="javascript:getItemImage('{{_id}}')">...</a>
			</div>
			{{/if}}
		<div class="name">
			{{name}}
		</div>
		<nav>
			<button class="take-btn btn btn-mini btn-info">
				<i class="icon-white icon-upload"></i>
			</button>
		</nav>
		<div class="clearfix"></div>
	</div>
{{else}}
	There are no items in this room.
	{{/each}}
	<div class="clearfix"></div>
</div>
</template>

<template name="currentUserImage">
{{#if currentUser}}
<div class="current-user">
	<div class="image" style="background-image:url({{imageUrl}})"></div>
</div>
{{/if}}
</template>

<template name="user-item">
<div class="user-item">
	{{#if imageUrl}}
	<div class="item image" style="background-image:url({{imageUrl}})"></div>
	{{else}}
	<div class="pull-left">
		<a class="assign" href="javascript:getItemImage('{{_id}}')">...</a>
	</div>
	{{/if}}

	{{#ifMine this}}
	<nav>
		<button class="drop-btn btn btn-small btn-info">
			Drop <i class="icon-white icon-download"></i>
		</button>
	</nav>
	{{/ifMine}}

	<div class="name">
		{{name}}
	</div>
	<div class="clearfix"></div>
</div>
</template>

<template name="user-items">
<div class="user-items">
	{{#each items}}
		{{> user-item}}
	{{/each}}
</div>
</template>

<template name="user">
<div class="user">
	<div class="avatar image" style="background-image: url({{imageUrl}})"></div>
	<div class="user-info">
		{{profile.name}}
	</div>
	<div class="clearfix">
	</div>
	{{> user-items}}
</div>
</template>

<template name="users">
<div class="users">
	{{#each users}}
		{{> user}}
	{{else}}
		No users.
	{{/each}}
</div>
</template>

<template name="messages">
{{#if messages}}
	<section id="messages">
		{{#if newerMessagesExist}}
		<nav>
			<button onclick="javascript:showNewerMessages()">Show newer messages</button>
		</nav>
		{{/if}}
		{{#each messages}}
			{{> message}}
		{{/each}}
		{{#if olderMessagesExist}}
		<nav>
			<button onclick="javascript:showOlderMessages()">Show older messages</button>
		</nav>
		{{/if}}
	</section>
{{else}}
	No messages.
{{/if}}
</template>

<template name="send-message">
{{#if currentUser}}
	<form onsubmit="event.preventDefault();">
		<input type="text" style="width:50%" name="new-message"></input>
		<button name="send">Send</button>
	</form>
{{/if}}
</template>

<template name="upload-photo">
{{#if currentUser}}
<form action="http://somebucket.amazonaws.com/" method="post" enctype="multipart/form-data" id="aws-upload">
	<input type="file" name="file" id="aws-file">
	<input type="hidden" name="policy">
	<input type="submit" name="submit" id="btn-submit">
</form>
{{/if}}
</template>

<template name="memificator">
<div class="meme-container" style="background-image: url({{imageUrl}})">
	<div class="inner">
		<div class="top">
			<span contenteditable data-msg-id="{{_id}}" id="meme-{{_id}}-title" class="title meme-text">{{{memeTitle}}}</span><br/>
		</div>
		<div class="bottom">
			<span contenteditable data-msg-id="{{_id}}" id="meme-{{_id}}-subtitle" class="subtitle meme-text">{{{memeSubtitle}}}</span>
		</div>
	</div>
</div>
</template>

<template name="memeDisplay">
<div class="meme-container"
	style="background-image: url({{imageUrl}})">
	<div class="inner">
		<div class="top">
			<span class="title meme-text">{{{memeTitle}}}</span><br/>
		</div>
		<div class="bottom">
			<span class="subtitle meme-text">{{{memeSubtitle}}}</span>
		</div>
	</div>
</div>
</template>

<template name="message">
<div class="message">
	<header>
		{{#withAuthor authorId}}
		<div class="author" title="{{name}}" style="background-image:url({{image}})"></div>
		<span class="name">{{name}}</span>
		{{/withAuthor}}
		<nav>
			{{#ifOwner this}}
				{{#if imageUrl}}
					{{#if meme}}
					{{else}}
					<button class="meme-btn">
						<i class="icon-text-width"></i>
					</button>
					{{/if}}
				{{/if}}
				<button class="delete-btn"><i class="icon-trash"></i></button>
			{{else}}
				{{#ifNotLoved this}}
					<button class="love-btn"><i class="icon-heart"></i></button>
				{{/ifNotLoved}}
			{{/ifOwner}}
		</nav>
	</header>
	{{#if meme}}
		{{#ifOwner this}}
			{{> memificator}}
		{{else}}
			{{> memeDisplay}}
		{{/ifOwner}}
	{{else}}
		{{#if msg}}
			<p>{{say msg}}<p>
		{{/if}}
		{{#if imageUrl}}
			<img src="{{imageUrl}}" />
		{{/if}}
		{{#if youtube}}
			<iframe id="ytplayer" type="text/html" width="400" height="244"
				src="http://www.youtube.com/embed/?q={{youtube}}&autoplay=0&origin=http://example.com"
				frameborder="0"></iframe>
		{{/if}}
	{{/if}}
	<div>
		{{#loveLoop this}}
			<i class="icon-heart"></i>
		{{/loveLoop}}
	</div>
</div>
</template>
