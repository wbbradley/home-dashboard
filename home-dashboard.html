<head>
	<title>Fort Borilliam</title>
	<script>
		function redisplayDiffTimes() {
			$('span[data-time]').each(function (index, value) {
				this.innerText = formatDate(parseInt(value.getAttribute('data-time')));
			});
		}
		$(function () {
			window.setInterval(redisplayDiffTimes, 2000);
		});
  </script>
</head>

<body>
	<div class="container-fluid" style="padding-top: 1.5em">
		<div class="row-fluid">
			<div class="span4">
				<div class="media">
					<img src="/fortress.png" class="pull-left"/>
					<div class="media-body">
						<h1>Fort Borilliam</h1>
					</div>
				</div>
			</div>
			<div class="span4">
				{{> weather-report}}
			</div>
		</div>
		<div class="row-fluid">
			<div class="span8">
				{{> send-message}}
				{{> messages}}
			</div>
		</div>
	</div>
</body>

<template name="weather-report">
<div style="align:right;padding: 2em 0 0 0;" class="pull-right">
{{#with weather}}
	{{weather.weather}} / {{feelslike_string}}
{{/with}}
	<br/>
	{{loginButtons}}
</div>
</template>

<template name="messages">
{{#if messages}}
<ul class="unstyled">
	{{#each messages}}
		{{> message}}
	{{/each}}
</ul>
{{else}}
	No messages.
{{/if}}
</template>

<template name="send-message">
{{#if currentUser}}
	<form onsubmit="event.preventDefault();" class="form-horizontal">
		<input type="text" style="width:50%" name="new-message"></input>
		<input class="btn btn-primary" type="button" name="send" value="Send"></input>
		<input class="btn pull-right" type="button" name="deleteAll" value="Delete"></input>
	</form>
{{/if}}
</template>

<template name="message">
<li class="message media">
	<div class="pull-left">
		<img class="img-circle avatar-img" src="{{getAuthorImage author}}" />
	</div>
	<div class="media-body">
		<div class="media-heading">
			<span class="author">
				<strong>{{author.profile.name}}</strong>
			</span>
			<span class="time muted pull-right">
				<span data-time="{{timestamp}}">{{date-render timestamp}}</span>
			</span>
		</div>
		<span class="sent-message">{{say msg}}</span>
	</div>
</li>
</template>
