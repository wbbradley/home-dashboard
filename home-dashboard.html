<head>
	<title>Fort Borilliam</title>
	<script>
		function redisplayDiffTimes() {
			$('span[data-time]').each(function (index, value) {
				this.innerText = formatDate(parseInt(value.getAttribute('data-time')));
			});
		}
		$(function () {
			window.setInterval(redisplayDiffTimes, 2000);
		});
	</script>
</head>

<body>
	<div class="container">
		<div class="row-fluid">
			<div class="span4">
				<h1>Fort Borilliam</h1>
			</div>
			<div class="span4">
				{{> weather-report}}
			</div>
		</div>
		<div class="row-fluid">
			<div class="span8">
				{{> send-message}}
				{{> messages}}
			</div>
		</div>
	</div>
</body>

<template name="weather-report">
{{#with weather}}
<div style="align:right;padding: 2em 0 0 0;" class="pull-right">
	{{weather.weather}} / {{feelslike_string}}
	<br/>
	{{loginButtons}}
</div>
{{/with}}
</template>

<template name="messages">
{{#if messages}}
<ul class="unstyled">
	{{#each messages}}
		{{> message}}
	{{/each}}
</ul>
{{else}}
	No messages.
{{/if}}
</template>

<template name="send-message">
{{#if currentUser}}
	<form onsubmit="event.preventDefault();" class="form-horizontal">
		<input type="text" name="new-message"></input>
		<input class="btn" type="button" name="send" value="Send"></input>
		<input class="btn pull-right" type="button" name="deleteAll" value="Delete"></input>
	</form>
{{/if}}
</template>

<template name="message">
<li class="message media">
	<div class="pull-left">
		<img class="img-circle avatar-img" src="{{getAuthorImage author}}" />
	</div>
	<div class="media-body">
		<div class="media-heading">
			<span class="author">
				<strong>{{author.profile.name}}</strong>
			</span>
			<span class="time muted pull-right">
				<span data-time="{{timestamp}}">{{date-render timestamp}}</span>
			</span>
		</div>
		{{msg}}
	</div>
</li>
</template>
